# DocumentManagementService

Пример простого приложения для управления документами.

## ▶️ Запуск проекта

Чтобы запустить этот проект и увидеть его в действии, выполните следующие шаги:

1. Склонируйте репозиторий на свой компьютер.

2. Откройте проект в вашей среде разработки (например, Visual Studio).

3. Выполнять миграции не требуется, настроенный *.db* файл для работы с Sqlite уже находится в корневой папке проекта с применёнными к нему миграциями.

4. Убедитесь что вверху раядом с кнопкой запуска выбран проект WebApi. Нажмите кнопку запуска, у вас откроется браузер по умолчанию с открытой страницей Swagger.

5. Чтобы запустить проект через терминал, перейдите в папку WebApi и введите `dotnet run`, а после, перейдите по указанному в терминале адресу с помощью браузера.

### PostgreSQL 

Чтобы переключиться на использование PostgreSQL, добавьте в корневую папку проекта файл .env. Пример переменных окружения в .env файле, используемых в проекте:

```
DB_HOST=localhost
DB_PORT=5432
DB_DATABASE=YourDatabase
DB_USERNAME=YourUsername
DB_PASSWORD=YourPassword
```
Также необходимо будет раскомментировать в Program.cs, отвечающий за подключение к Postgres. И наоборот - в `DocumentManagementDbContext` закомментировать метод `OnConfiguring`. 

Уберите старые миграции и создайте новые для Postgres.

### Миграции:

Если вам необходимо изменить схему БД, создав новую миграцию, откройте Package Manager Console и введите `Add-Migration`. Чтобы применить изменения к БД введите `Update-Database`.

## Задача:

Создание мини-приложения для управления процессами в системе СЭД TESSA.

### Требования:

**Бэкенд:**

- Разработать Web API с использованием [ASP.NET](http://asp.net/) Core 6+ для управления документами и связанными с ними задачами.
- Спроектировать модели `Документ` и `Задача`, учитывая, что одному документу может соответствовать множество задач.
- Реализовать логику изменения статусов документа в зависимости от выполнения задач.
- Взаимодействие с базой данных SQLite реализовывать с использованием Entity Framework Core.
- Написать методы CRUD для работы с документами.

**Фронтенд (опционально):**

- *Опционально:* Создать клиентский интерфейс на React для работы с задачами и документами. (Если не знаешь React допустимо использовать Swagger).

#### Реализация: `Swagger`

**Общие требования:**

- Настройка миграций для инициализации схемы базы данных. 
- Обработка ошибок и валидация данных на сервере.
- Чистый и поддерживаемый код 

### Результаты:

Проект должен быть размещён на GitHub с README файлом, содержащим инструкции для запуска, и обзором реализованных функций.

### Пример JSON структуры для `Документ`:

```json
{
  "Document": {
    "ID": "doc-123",
    "Status": "В работе",
    "ActiveTask": {
		    "ID": "task-1",
		    "Name": "Первая задача",
		    "Status": "В работе",
		    "PreviousTaskID": null
		  },
    "Tasks": [
      {
        "ID": "task-2",
        "Name": "Задача 2",
        "PreviousTaskID": "task-1"
      },
      {
        "ID": "task-3",
        "Name": "Задача 3",
        "PreviousTaskID": "task-2"
      },
      {
        "ID": "task-4",
        "Name": "Задача 4",
        "PreviousTaskID": "task-3"
      },
      {
        "ID": "task-5",
        "Name": "Задача 4",
        "PreviousTaskID": "task-4"
      }
    ]
  }
}

```

В этой структуре `ActiveTask` содержит задачу, которая в данный момент активна для документа, а `Tasks` - это полный список задач. PreviousTaskID указывает на связь с предыдущей задачей в цепочке процесса.

### Этап 1

Создать документ с task-1 активной задачей. Статус документа “В работе”. У активной задачи есть две кнопки “Выполнить” и “Отмена”.

#### Реализация: 

Создать новый документ с соответствующим наполнением возможно в контроллере ***Documents*** на эндпоинте `POST /api/Documents`

В папке `Database.DocumentManagement.Migrations/JsonExamplesToPost` лежит *.json* файл, содержимое которого можно быстро вставить в дело запроса на данном эндпоинте.

### Этап 2

При выборе одной из двух кнопок ( “Выполнить” и “Отмена”) в задачи task-1: 

- Выполнить - переход по цепочке далее к task-2. И так до конца всех задач. При успешном выполнении всей цепочки задач менять статус документа В оперативном архиве.
- Отмена - если хоть одну задачу отменили, обнулять ссылку ActiveTask и менять статус документа на Отмена.

#### Реализация: 

***TaskItems***

`PATCH /api/TaskItems/{id}/execute`

`PATCH /api/TaskItems/{id}/cancel`

### Этап 3

Реализовать CRUD операции с документами.
#### Реализация: 

***Documents***

`GET /api/Documents`

`POST /api/Documents`

`DELETE /api/Documents`

`GET /api/Documents/{id}`

`PUT /api/Documents/{id}`

`DELETE /api/Documents/{id}`
